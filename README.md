# Расширение «Ozon Price Tracker»

Это расширение для Google Chrome позволяет добавлять товары с маркетплейса [Ozon](https://www.ozon.ru/) в список отслеживания и автоматически узнавать об изменении их стоимости. Расширение показывает текущую, среднюю цену и величину скидки по каждому товару, а также присылает уведомления через Web Push, когда цена меняется.

## Основные возможности

- Кнопка на странице любого товара Ozon, которая добавляет товар в отслеживание.
- Автоматическое получение цены с заданной периодичностью (по умолчанию — раз в час).
- Использует официальный [Ozon Seller API](https://docs.ozon.ru/api/seller/) для фонового обновления цен без открытия карточек.
- Сохранение истории цен, вычисление средней стоимости и размера скидки.
- Web Push уведомления браузера при заметном снижении цены или достижении заданного порога.
- Окно расширения (по нажатию на иконку), где видно список всех отслеживаемых товаров.
- Отдельная страница во вкладке браузера со всем списком и расширенными данными.
- Компактный график изменения цены у каждого товара прямо в окне расширения.
- Страница настроек, где можно выбрать, как часто проверять цены.
- Индивидуальные пороги цены для каждого товара: укажите значение, и браузер оповестит, когда цена опустится ниже него.

## Структура папки `extension`

```
extension/
├── background.js      # Сервис-воркер, выполняющий проверки цен и уведомления
├── contentScript.js   # Скрипт, который добавляет виджет на странице товара
├── contentStyles.css  # Оформление всплывающего виджета на странице товара
├── manifest.json      # Конфигурация Chrome Extension (Manifest v3)
├── options.html       # Страница настроек интервала
├── options.js         # Логика сохранения настроек
├── popup.html         # Разметка всплывающего окна расширения
├── popup.css          # Стили всплывающего окна
├── popup.js           # Управление списком в всплывающем окне
├── tracker.html       # Полноэкранная страница со всеми товарами
├── tracker.css        # Стили страницы со списком товаров
├── tracker.js         # Логика страницы со списком товаров
├── viewHelpers.js     # Общие функции отрисовки карточек и графиков
```

## Как установить расширение (подробно и «с нуля»)

Ниже приведена максимально подробная инструкция для людей без технического опыта. Следуйте шаг за шагом — всё получится.

1. **Подготовьте папку с расширением**
   1. Откройте папку проекта на компьютере. Если вы получили её в архиве, сначала распакуйте архив. Внутри должна быть папка `extension`.
   2. Убедитесь, что внутри `extension` есть файл `manifest.json` и другие файлы, перечисленные выше.

2. **Откройте Google Chrome**
   1. Запустите браузер Google Chrome (значок с красно-зелёно-жёлтым кругом и синей серединой).
   2. Проверьте, чтобы версия браузера была не слишком старой. Расширение рассчитано на Manifest v3, который поддерживают последние версии Chrome.

3. **Перейдите в раздел расширений**
   1. В правом верхнем углу Chrome нажмите на кнопку «⋮» (три точки).
   2. В выпадающем меню наведите курсор на пункт «Дополнительные инструменты».
   3. В появившемся подменю выберите пункт «Расширения». Откроется новая вкладка `chrome://extensions/`.

4. **Включите режим разработчика**
   1. В правом верхнем углу страницы «Расширения» найдите переключатель «Режим разработчика».
   2. Включите его — переключатель должен загореться синим цветом, а сверху появятся дополнительные кнопки.

5. **Загрузите наше расширение**
   1. Нажмите кнопку «Загрузить распакованное» (она появится после включения режима разработчика).
   2. Откроется окно выбора папки. Найдите папку проекта и внутри неё выберите папку `extension` (именно эту папку, без перехода внутрь неё).
   3. Нажмите кнопку «Выбрать папку» (или «Select Folder»). Chrome установит расширение и покажет его в списке.

6. **Закрепите иконку (по желанию)**
   1. В правом верхнем углу Chrome нажмите на значок «Расширения» (пазл).
   2. Найдите «Ozon Price Tracker» и нажмите на значок булавки, чтобы иконка закрепилась на панели браузера.

7. **Проверьте работу расширения**
   1. Перейдите на любую карточку товара на сайте Ozon.
   2. В правом нижнем углу появится аккуратная панель расширения. Нажмите «Добавить в отслеживание», чтобы товар попал в список.
   3. Кликните по иконке расширения в панели браузера — откроется окно со списком отслеживаемых товаров.
   - Карточки отображаются в компактном виде: видно цену при добавлении и текущую. Нажмите кнопку с символом ▸, чтобы раскрыть подробности, график и настройки.
 - Если хотите открыть список в отдельной вкладке, нажмите кнопку «Открыть страницу списка» внизу всплывающего окна.

## Как включить уведомления

1. Откройте всплывающее окно расширения (кликните по иконке на панели браузера) или страницу со списком товаров.
2. При первом открытии Chrome покажет небольшое окошко с запросом разрешения на показ уведомлений. Нажмите «Разрешить».
3. Если запрос не появился, нажмите на замок слева от адреса страницы и проверьте раздел «Уведомления» — установите значение «Разрешить».
4. После подтверждения расширение будет отправлять уведомления через Web Push прямо в браузер, как только произойдут важные изменения цены.

## Настройка интервала проверки цен

1. Откройте страницу настроек:
   - В появляющемся на товаре виджете нажмите ссылку «Настройки проверки», **или**
   - Нажмите на иконку расширения → кнопку ⚙ в правом верхнем углу всплывающего окна.
2. В поле «Интервал проверки (в минутах)» укажите желаемое значение. Минимально возможное — 1 минута.
3. Нажмите кнопку «Сохранить». Появится надпись «Настройки сохранены…». Теперь расширение будет автоматически использовать выбранный интервал.

## Как подключить доступ к Ozon Seller API

1. Авторизуйтесь в кабинете продавца Ozon и откройте раздел **Настройки → API**.
2. Создайте ключ с правами на просмотр информации о товарах и ценах. Сохраните показанные значения **Client ID** и **API Key** — они понадобятся расширению.
3. Вернитесь в Chrome и откройте настройки расширения (кнопка ⚙ или пункт «Настройки проверки» в виджете).
4. В блоке «Параметры доступа к Ozon Seller API» введите Client ID и API Key. Поле для ключа можно оставить пустым, если хотите обновить только интервал.
5. Нажмите «Сохранить». Расширение запишет данные локально и сразу начнёт отправлять запросы к `https://api-seller.ozon.ru` при ручных и автоматических проверках.
6. При необходимости измените или удалите ключ в личном кабинете Ozon — после этого обновите данные и в расширении.

> ⚠️ Данные API-ключа не передаются на сторонние сервера и остаются в локальном хранилище Chrome. Тем не менее рекомендуем создавать отдельный ключ только для чтения цен специально для расширения.

## Как задать порог уведомления по цене

1. Нажмите на иконку расширения, чтобы открыть список отслеживаемых товаров, или воспользуйтесь кнопкой «Открыть страницу списка», чтобы работать в отдельной вкладке.
2. У каждого товара появилось поле «Порог уведомления (₽)». Введите в него желаемую цену.
   - Чтобы очистить порог и получать только уведомления о снижении, оставьте поле пустым и просто нажмите Enter или переключитесь на другое поле.
3. После ввода значение сохранится автоматически. Под полем появится надпись «Уведомим при цене ≤ …», когда порог сохранён успешно.
4. При следующей автоматической проверке расширение пришлёт уведомление, если цена товара стала ниже указанного значения.

## Как открыть отдельную страницу со всем списком

1. Нажмите на иконку расширения, чтобы открыть небольшое всплывающее окно.
2. В нижней части окна нажмите кнопку «Открыть страницу списка».
3. Браузер откроет новую вкладку с блоками отслеживаемых товаров: карточки автоматически раскладываются по несколько колонок (на широком экране помещается до пяти) и остаются выровненными по центру. Здесь доступны те же действия, что и во всплывающем окне: можно изменить порог уведомления, открыть карточку на Ozon, обновить цены и удалить позиции.
4. При необходимости вернитесь в всплывающее окно — данные синхронизируются автоматически.

## Как читать график изменения цены

1. Откройте список отслеживаемых товаров — через иконку расширения или на отдельной странице (кнопка «Открыть страницу списка» во всплывающем окне).
2. Под основной информацией каждого товара расположен светлый блок с мини-графиком.
3. Линия показывает, как менялась цена за последние обновления: чем выше точка, тем дороже была позиция.
4. Заштрихованная область под линией помогает быстро увидеть тренд. Последняя точка подсвечена — это текущая цена.
5. Под графиком есть подпись: количество последних обновлений и диапазон цен за этот период.
6. Если данных ещё недостаточно, появится подсказка «История цен появится после нескольких обновлений» — просто подождите, пока сервис-воркер соберёт больше точек.

## Полезные советы и ограничения

- Чтобы получать Web Push уведомления о снижении цены, убедитесь, что в Chrome разрешены уведомления для браузера, а сайт не заблокирован в списке «Без уведомлений» (значок замка слева от адреса → «Уведомления» → «Разрешить»).
- Расширение хранит историю цен локально в вашем браузере. Если вы очистите данные браузера или переустановите расширение, история будет потеряна.
- Некоторые товары на Ozon могут загружаться нестандартным образом. Если цена не определяется автоматически, обновите страницу или повторно добавьте товар.
- Для корректной работы автоматических проверок держите Chrome запущенным. Сервис-воркер будет периодически обращаться к страницам товаров и обновлять историю цен.

## Как удалить расширение

1. Перейдите на страницу `chrome://extensions/` (как описано выше).
2. Найдите «Ozon Price Tracker» и выключите переключатель, чтобы временно остановить работу, либо нажмите «Удалить», чтобы полностью удалить расширение.
3. Если вы удаляете расширение окончательно, подтвердите действие в появившемся окне.

Если у вас возникнут трудности, повторите шаги или перезапустите браузер. Большинство проблем решается переустановкой расширения и повторным добавлением товара в отслеживание.
