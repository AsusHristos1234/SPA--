# Легенды Эльдруина — пошаговая телеграм-игра

Этот проект содержит простой веб-интерфейс (Next.js) и отдельного телеграм-бота с пошаговой RPG-историей в фэнтези-стиле. Управление в боте происходит через кнопки под сообщениями, так что играть можно буквально одним пальцем.

## 1. Что потребуется

1. **Компьютер с доступом в интернет.** Подойдёт Windows, macOS или Linux.
2. **Браузер** (Chrome, Firefox, Safari и т.п.) — чтобы скачать проект и читать инструкцию.
3. **Telegram** на телефоне или компьютере — чтобы играть и получать сообщения от бота.
4. **Node.js версии 18 или выше.** Это программа, которая позволит запустить бота. Если Node.js ещё не установлен:
   - Перейдите на сайт <https://nodejs.org>.
   - Нажмите большую зелёную кнопку «LTS» и скачайте установщик.
   - Запустите скачанный файл и нажимайте «Next»/«Далее», пока установка не завершится. После установки перезапустите компьютер (желательно, но не обязательно).
5. **Токен телеграм-бота.** Его выдаёт официальная служба Telegram под названием BotFather.

### Как получить токен у BotFather

1. Откройте Telegram и в поиске найдите пользователя `@BotFather` (у него синяя галочка).
2. Нажмите «Start» или введите `/start`.
3. Введите команду `/newbot`.
4. BotFather попросит назвать бота — придумайте любое имя (например, «Герой Эльдруина»).
5. Затем попросит логин (должен заканчиваться на `bot`, например, `EldruinAdventureBot`).
6. В ответ вы получите сообщение с длинной строкой вида `1234567890:AA...`. Это и есть **токен** — скопируйте его и сохраните в надёжном месте.

## 2. Как скачать и открыть проект

### Вариант А. Через Git (для тех, кто знаком с GitHub)
1. Откройте терминал или командную строку.
2. Введите команду (подставьте свою папку вместо `C:\projects`):
   ```bash
   cd C:\projects
   git clone https://github.com/<имя_вашего_репозитория>/SPA-.git
   cd SPA-
   ```

### Вариант Б. Через архив (проще всего)
1. На странице проекта нажмите кнопку «Code» → «Download ZIP».
2. Когда архив скачается, распакуйте его. На Windows щёлкните правой кнопкой мыши → «Извлечь всё». На macOS достаточно дважды щёлкнуть по архиву.
3. Откройте распакованную папку `SPA-`.

Дальнейшие шаги одинаковые для всех способов.

## 3. Подготовка к запуску бота

1. Откройте папку проекта в Проводнике (Windows) или Finder (macOS).
2. Щёлкните правой кнопкой мыши по свободному месту и выберите «Открыть в Терминале» / «Открыть в Windows Terminal». Если такой пункт отсутствует, откройте командную строку вручную:
   - Нажмите клавиши `Win + R`, введите `cmd` и нажмите Enter.
   - Выполните команду `cd` с путём к папке. Пример:
     ```bash
     cd C:\Users\Иван\Downloads\SPA-
     ```
3. Проверьте, что Node.js установлен. Введите:
   ```bash
   node -v
   ```
   Если видите номер версии (например, `v18.19.0`), всё готово. Если появится сообщение об ошибке, вернитесь к шагу установки Node.js.
4. Установите переменную окружения с токеном бота. Это нужно сделать один раз перед запуском.

   **Windows (PowerShell):**
   ```powershell
   setx BOT_TOKEN "ВАШ_ТОКЕН_ОТ_BOTFATHER"
   ```
   После команды закройте и заново откройте окно PowerShell, чтобы значение обновилось.

   **Windows (командная строка только на текущую сессию):**
   ```cmd
   set BOT_TOKEN=ВАШ_ТОКЕН_ОТ_BOTFATHER
   ```

   **macOS / Linux:**
   ```bash
   export BOT_TOKEN="ВАШ_ТОКЕН_ОТ_BOTFATHER"
   ```

   Замените текст `ВАШ_ТОКЕН_ОТ_BOTFATHER` на реальное значение вида `1234567890:AA...`.

5. *(Необязательно, но полезно)* Настройте список администраторов — людей, которые смогут изменять монстров, предметы и локации прямо из Telegram. Для этого добавьте переменную окружения `ADMIN_IDS` с числами (это Telegram ID пользователей) через запятую.

   Узнать свой ID можно у ботов `@userinfobot` или `@RawDataBot`: они пришлют сообщение вроде `Id: 123456789`. Это число и нужно указать в переменной.

   **Windows (PowerShell):**
   ```powershell
   setx ADMIN_IDS "123456789,987654321"
   ```

   **Windows (только текущая сессия):**
   ```cmd
   set ADMIN_IDS=123456789,987654321
   ```

   **macOS / Linux:**
   ```bash
   export ADMIN_IDS="123456789,987654321"
   ```

   Если переменную не указывать, админ-команды будут недоступны, но сам бот продолжит работать.

## 4. Запуск телеграм-бота

1. В том же терминале убедитесь, что находитесь в корневой папке проекта (должно быть видно `bot` и `package.json` при команде `dir` или `ls`).
2. Выполните команду:
   ```bash
   node bot/gameBot.js
   ```
3. В терминале появится сообщение `Бот запущен. Ожидание событий...` — значит, бот готов.
4. Откройте чат с вашим ботом в Telegram и нажмите «Start» или введите `/start`.
5. Наслаждайтесь приключением! Кнопки под сообщениями позволяют выбирать действия, а команды `/status`, `/restart` и `/help` помогут контролировать героя.

> **Важно:** бот хранит прогресс в памяти компьютера. Если закрыть терминал или выключить компьютер, игра начнётся заново.

## 5. Файлы данных игры

Вся игровая информация вынесена в отдельные файлы в папке `bot/data`:

- `monsters.json` — список врагов (имя, здоровье, описание, награды).
- `items.json` — предметы, которые может получить герой (тип, описание, эффекты).
- `locations.json` — названия и описания мест, которые появляются в истории.

Файлы написаны в формате JSON. Каждый объект имеет поле `id` — уникальный идентификатор, который использует бот. Пример записи для монстра:

```json
{
  "id": "forest_wolf",
  "name": "Лесной волк",
  "description": "Хищник с серебристой шерстью, охраняющий свои владения.",
  "hp": 12,
  "attack": 4,
  "reward": {
    "gold": 3,
    "items": ["wolf_fang"]
  }
}
```

Вы можете редактировать эти файлы вручную в любом текстовом редакторе (например, Блокнот, VS Code или Notepad++). После сохранения бот автоматически подхватит изменения при следующем запуске. Если правки нужно применить без перезапуска, используйте админ-команду `/reload_data`.

## 6. Админ-режим (редактирование прямо в Telegram)

Если ваш Telegram ID указан в переменной `ADMIN_IDS`, в чате с ботом станут доступны специальные команды:

- `/admin` — подсказка со всеми админ-командами.
- `/list_monsters`, `/list_items`, `/list_locations` — вывести списки с идентификаторами и названиями.
- `/add_monster {json}`, `/add_item {json}`, `/add_location {json}` — добавить или обновить запись. Текст после команды должен быть корректным JSON-объектом с полем `id`.
- `/delete_monster ID`, `/delete_item ID`, `/delete_location ID` — удалить запись по идентификатору.
- `/reload_data` — перечитать данные из файлов.

Пример добавления нового предмета:

```
/add_item {"id":"elixir_of_light","name":"Эликсир света","type":"consumable","description":"Мгновенно восстанавливает здоровье","effects":{"heal":10}}
```

Бот ответит «Предмет elixir_of_light сохранён.» и внесёт запись в `bot/data/items.json`.

## 7. Что делает бот

- **/start** — начинает новое приключение.
- **/status** — показывает здоровье, ману, золото и инвентарь героя.
- **/restart** — мгновенно перезапускает историю.
- **/help** — напоминает, как управлять игрой.
- Кнопки под сообщениями ведут по сюжету: можно посетить таверну, исследовать лес, сразиться с волками и найти артефакт «Сердце Бури».

История линейная, но у каждого выбора есть последствия. Нужные предметы пополняют инвентарь, неправильные решения могут стоить здоровья, а удачные — принесут золото и новые возможности.

## 8. Как остановить бота

- В терминале нажмите `Ctrl + C`. Появится сообщение «Остановка бота...», и программа завершится.

## 9. Частые проблемы и их решения

| Проблема | Что делать |
| --- | --- |
| После запуска появляется сообщение «Не найден токен» | Проверьте, что переменная `BOT_TOKEN` установлена. Если сомневаетесь, повторите команду из раздела 3 и перезапустите терминал. |
| Команда `node` не найдена | Node.js установлен не полностью или компьютер не перезагружался после установки. Повторите установку с сайта <https://nodejs.org> и перезагрузите систему. |
| Бот не отвечает в Telegram | Убедитесь, что программа всё ещё работает в терминале и что токен верный. Попробуйте остановить бот (`Ctrl + C`) и запустить снова. |
| Хочу изменить сюжет | Измените данные в файлах `bot/data/*.json` и, при необходимости, добавьте новые шаги или проверки в `bot/gameBot.js`. После правок выполните `/reload_data` или перезапустите бота. |

## 10. Дополнительно

- Чтобы запустить веб-приложение (необязательно для бота), используйте команды:
  ```bash
  npm install
  npm run dev
  ```
  Затем откройте <http://localhost:3000> в браузере.
- При необходимости можно настроить автоматический запуск бота на сервере. Для этого подойдут менеджеры процессов вроде `pm2`, но их настройка выходит за рамки данной инструкции.

Если что-то не получается, перепроверьте шаги и не стесняйтесь начинать заново — игра рассчитана даже на тех, кто только знакомится с компьютером.
